!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).CardPicker=e()}(this,function(){"use strict";function i(t){this.selectedList=[],this.selectedTarget=null,this.$options={isShowControl:!1,level:-1,caseName:{text:"text",children:"children"},isFullScreen:!1,title:""},this._init(t)}return i.prototype._init=function(t){var e=this;this.optionsMerge(t),this.triggerOptionsVerify(),this.dataOptionsVerify(),this.trigger.addEventListener("click",function(){e.createContainer()})},i.prototype.optionsMerge=function(t){i.prototype.$options=this.util.m(this.$options,t)},i.prototype.triggerOptionsVerify=function(){if("trigger"in this.$options){var t=this.$options.trigger;if("string"==typeof t){var e=document.querySelector(t);e?i.prototype.trigger=e:console.error("[CardPicker warn]: ".concat(t,"  is not a valid selector."))}else t?i.prototype.trigger=t:console.error("[CardPicker warn]: Can not resolve the trigger DOM.")}else console.error("[CardPicker warn]:The parameter item trigger is required.")},i.prototype.dataOptionsVerify=function(){"list"in this.$options?0==this.$options.list.length&&console.error("[CardPicker warn]:The parameter item ` list ` is empty."):console.error("[CardPicker warn]:The parameter item ` list ` is required.")},i.prototype.initView=function(){this.updateTabView(),this.updateListView()},i.prototype.initEventsConfig=function(){this.tabContainer=new BScroll(this.util.g(".rookie-tab"),{scrollX:!0,scrollY:!1,momentum:!0,tap:!0,stopPropagation:!1}),this.listContainer=new BScroll(this.$cache.listWrpper,{scrollX:!1,scrollY:!0,momentum:!0,tap:!0,stopPropagation:!1})},i.prototype.initEvents=function(){var r=this;this.util.g(".rookie-mask").addEventListener("touchmove",function(t){t.preventDefault()},!1),this.util.g(".rookie-mask").addEventListener("click",function(t){t.stopPropagation(),t.preventDefault(),r.util.g(".rookie-content").classList.remove("rookie-picker-modal-visible"),setTimeout(function(){document.body.removeChild(document.querySelector(".rookie-container"))},300)},!1),this.$cache.tab.addEventListener("tap",function(t){t.stopPropagation(),t.preventDefault();var e=r.selectedList.length,i=t.target;if(i.classList.contains("rookie-tab-item"))if(0==e)r.util.g(".rookie-tab-opactiy").classList.remove("rookie-tab-opactiy"),r.selectedList.splice(0);else if(i.classList.contains("rookie-tab-last")){if("请选择"===i.innerHTML)return}else{r.util.g(".rookie-tab-opactiy").classList.remove("rookie-tab-opactiy");var o=i.innerHTML,s=r.selectedList.indexOf(o);r.selectedList.splice(s)}},!1),this.$cache.ul.addEventListener("tap",function(t){if(t.stopPropagation(),t.preventDefault(),"请选择"==r.util.g(".rookie-tab-last").innerHTML){try{r.util.g(".rookie-tab-opactiy").classList.remove("rookie-tab-opactiy")}catch(t){}r.selectedList.push(t.target.innerHTML)}else{try{r.util.g(".rookie-tab-opactiy").classList.remove("rookie-tab-opactiy")}catch(t){}r.selectedList.splice(r.selectedList.length-1,1,t.target.innerHTML)}-1!=r.$options.level&&r.$options.level==r.selectedList.length&&(r.$options.success&&r.$options.success(r.selectedList,r.selectedTarget),r.util.g(".rookie-content").classList.remove("rookie-picker-modal-visible"),setTimeout(function(){document.body.removeChild(document.querySelector(".rookie-container"))},300))},!1),this.$options.isShowControl&&this.util.g(".rookie-control-confirm").addEventListener("click",function(t){t.stopPropagation(),t.preventDefault(),(r.selectedList.length||r.selectedTarget)&&(r.$options.success&&r.$options.success(r.selectedList,r.selectedTarget),r.selectedList=[],r.selectedTarget=null,r.util.g(".rookie-content").classList.remove("rookie-picker-modal-visible"),setTimeout(function(){document.body.removeChild(document.querySelector(".rookie-container"))},300))},!1),this.$options.isShowControl&&this.util.g(".rookie-control-cancel").addEventListener("click",function(t){t.stopPropagation(),t.preventDefault(),r.util.g(".rookie-content").classList.remove("rookie-picker-modal-visible"),setTimeout(function(){document.body.removeChild(document.querySelector(".rookie-container"))},300)},!1)},i.prototype.updateListView=function(t){var i=this;this.$cache.ul.innerHTML=t?t.reduce(function(t,e){return t+'<li class="'.concat(i.$options.caseName&&i.$options.caseName.children&&e[i.$options.caseName.children]?"arrow":"",'">').concat(e[i.$options.caseName.text],"</li>")},""):this.$options.list.reduce(function(t,e){return t+'<li class="'.concat(i.$options.caseName&&i.$options.caseName.children&&e[i.$options.caseName.children]?"arrow":"",'">').concat(e[i.$options.caseName.text],"</li>")},"")},i.prototype.updateTabView=function(){var t=this,e="";if(!(0<arguments.length&&void 0!==arguments[0]&&arguments[0]))if(2==this.$options.level)for(var i=0;i<this.selectedList.length;i++)e+='<div class="rookie-tab-item rookie-tab-selected" style="width:40vw;">'.concat(this.selectedList[i],"</div>");else for(var o=0;o<this.selectedList.length;o++)e+='<div class="rookie-tab-item rookie-tab-selected">'.concat(this.selectedList[o],"</div>");2==this.$options.level?e+='<div class="rookie-tab-item rookie-tab-active rookie-tab-last" style="width:40vw;">请选择</div>':e+='<div class="rookie-tab-item rookie-tab-active rookie-tab-last">请选择</div>',this.$cache.tab.innerHTML=e,this.tabContainer&&this.tabContainer.refresh(),this.tabContainer&&this.tabContainer.scrollTo(-this.util.g(".rookie-tab-wrapper").offsetWidth,0,0),setTimeout(function(){t.util.g(".rookie-tab-wrapper").classList.add("rookie-tab-opactiy")},300)},i.prototype.util={g:function(t,e){return document[e?"querySelectorAll":"querySelector"](t)},m:function(t,e){for(var i in e)t[i]=t[i]&&"[object Object]"===t[i].toString()?this.m(t[i],e[i]):t[i]=e[i];return t}},i.prototype.queryList=function(){var s=this,t=this.$options.list.slice(),r=this.selectedList.slice(),n=[];return function t(e){for(var i=0;i<r.length;i++){var o=e.find(function(t){return t[s.$options.caseName.text]==r[0]});s.selectedTarget=o,n=o[s.$options.caseName.children]?o[s.$options.caseName.children]:[],1<r.length&&(r.splice(0,1),t(n))}}(t),n},i.prototype.initArrayListener=function(){var i=this,t=Array.prototype,o=Object.create(t),s=[];["push","pop","shift","unshift","splice","sort","reverse"].forEach(function(t){var e=o[t];s[t]=function(){return e.apply(this,arguments),i.notify.apply(i,[t].concat(Array.prototype.slice.call(arguments)))}}),this.selectedList=[],this.selectedList.__proto__=s},i.prototype.notify=function(){var t=this,e=Array.prototype.slice.call(arguments),i=e[0],o=e[1],s=this.queryList();"push"==i?0==s.length?(this.util.g(".rookie-tab-last").innerHTML=this.selectedList[this.selectedList.length-1],setTimeout(function(){t.util.g(".rookie-tab-wrapper").classList.add("rookie-tab-opactiy")},300)):(this.updateListView(s),this.updateTabView()):"splice"==i&&("请选择"!=this.util.g(".rookie-tab-last").innerHTML?0==s.length?"[object Object]"===Object.prototype.toString.call(this.selectedTarget)&&0==this.selectedList.length&&0==o?(this.selectedTarge=null,this.updateTabView(!0),this.updateListView()):(this.util.g(".rookie-tab-last").innerHTML=this.selectedList[this.selectedList.length-1],this.tabContainer&&this.tabContainer.scrollTo(-this.util.g(".rookie-tab-wrapper").offsetWidth,0,0),setTimeout(function(){t.util.g(".rookie-tab-wrapper").classList.add("rookie-tab-opactiy")},300)):(this.updateTabView(),this.selectedTarget.children&&this.updateListView(this.selectedTarget.children)):0==o?(this.updateTabView(!0),this.updateListView()):0==s.length?(this.updateTabView(),this.updateListView(s)):(this.updateTabView(),this.selectedTarget.children&&this.updateListView(this.selectedTarget.children)))},i.prototype.createContainer=function(){var t=this;document.body.insertAdjacentHTML("beforeend",'\n  <div class="rookie-container weui-picker-modal">\n  <div class="rookie-mask">\n  </div>\n  <div class="rookie-content">\n  <div class="rookie-hd">\n  '.concat(this.$options.title.length?'<div class="rookie-title">'.concat(this.$options.title,"</div>"):"","\n  ").concat(this.$options.isShowControl?'<div class="rookie-control"><button class="rookie-control-cancel">取消</button><button class="rookie-control-confirm">确定</button></div>':"",'\n  <div class="rookie-tab-view"><div class="rookie-tab"><div class="rookie-tab-wrapper"><div class="rookie-tab-item rookie-tab-last rookie-tab-active">请选择</div></div></div></div></div><div class="rookie-bd"><ul class="rookie-bd-ul"></ul></div></div></div>')),this.$options.isFullScreen&&this.util.g(".rookie-content").classList.add("rookie-full-screen"),1==this.$options.level?this.util.g(".rookie-tab-view").style="display:none;":2==this.$options.level&&(this.util.g(".rookie-tab-last").style="width:40vw;"),setTimeout(function(){t.util.g(".rookie-content").classList.add("rookie-picker-modal-visible")},0),this.$cache={container:document.querySelector(".rookie-container"),ul:document.querySelector(".rookie-bd-ul"),listWrpper:document.querySelector(".rookie-bd"),tab:document.querySelector(".rookie-tab-wrapper")},this.initArrayListener(),this.initView(),this.initEventsConfig(),this.initEvents()},i});
