/*!
 * PickerCard.js v1.0.0
 * (c) 2020 ShuFei
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).PickerCard=t()}(this,function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function e(e){if(this.defaultConfig={title:"",isShowControl:!1,level:null,caseName:{text:"text",children:"children"}},this.caseName=Object.assign(this.defaultConfig.caseName,e.caseName),this.options=Object.assign(this.defaultConfig,e),this.options.caseName=this.caseName,!this.options.hasOwnProperty("trigger"))throw Error("The parameter item trigger is required.");if(this.IsDom(this.options.trigger))this.trigger=this.options.trigger;else{if(this.trigger=this.GetElement(this.options.trigger),!this.trigger)throw Error(this.trigger+" is not a valid selector.");if(!this.options.trigger.length)throw Error("The provided trigger selector is empty value.")}this.list=this.options.list,this.selectedList=[],this.Init()}return e.prototype.IsDom=function(e){return"object"===t(e)&&e instanceof HTMLElement&&"string"==typeof e.nodeName&&1===e.nodeType},e.prototype.Init=function(){var e=this;this.trigger.addEventListener("click",function(){e.CreateContainer(),e.CreateTitleItem(),e.Open(),e.StartListen()},!1)},e.prototype.StartListen=function(){var c=this;this.picker.addEventListener("click",function(e){if(e.stopPropagation(),e.preventDefault(),e.target.classList.contains("picker-card"))return c.Close();var t=e.target.className,i=e.target.innerHTML;if(t.includes("picker-item")){if("请选择"!==c.GetElement(".picker-preview-item-last").innerHTML)return c.selectedList.splice(c.selectedList.length-1,1),c.selectedList.push(i),c.GetRenderList().length?(c.Render(),void c.CreateTitleItem()):void(c.GetElement(".picker-preview-item-last").innerHTML=i);c.GetElement(".picker-preview-item-last").innerHTML=i;var s=c.GetRenderList().find(function(e){return e[c.options.caseName.text]===i});if(!s.hasOwnProperty(c.options.caseName.children)||s[c.options.caseName.children]&&!s[c.options.caseName.children].length)return c.selectedList.push(i),void(c.options.isShowControl||(c.options.success&&c.options.success(c.selectedList,s),c.Close()));if(c.selectedList.push(i),!isNaN(parseFloat(c.options.level))&&isFinite(c.options.level)&&c.options.level==+t.substr(12)+1)return c.options.success&&c.options.success(c.selectedList,s),c.Close();c.Render(),c.CreateTitleItem()}if(t.includes("picker-preview-item")){var r=+t.substr(20,1);if(isNaN(r))return;console.log(r),c.selectedList=c.selectedList.slice(0,r),c.Render(),c.CreateTitleItem()}if(t.includes("picker-card-cancel")&&c.Close(),t.includes("picker-card-confirm")){if(!c.selectedList.length)return;var n=c.GetRenderList(c.selectedList.slice(0,-1)).find(function(e){return e[c.options.caseName.text]===c.selectedList[c.selectedList.length-1]});c.options.success&&c.options.success(c.selectedList,n),c.Close()}})},e.prototype.CreateContainer=function(){document.body.insertAdjacentHTML("beforeend",'<div class="picker-card picker-card-hide"><div class="picker-card-container picker-card-hide"><div class="picker-card-content">'.concat(this.options.title&&this.options.title.length?'<div class="picker-card-title">'.concat(this.options.title,"</div>"):"").concat(this.options.isShowControl?'<div class="picker-card-control"> <span class="picker-card-cancel">取消</span> <span class="picker-card-confirm">确定</span></div>':"",'<div class="picker-card-preview"><div class="picker-preview-item picker-preview-item-0"><span class="picker-preview-item-last picker-preview-active">请选择</span></div></div><div class="picker-card-view"></div></div></div></div>')),this.picker=this.GetElement(".picker-card"),this.pickerTopbar=this.GetElement(".picker-card-preview"),this.pickerContainer=this.GetElement(".picker-card-container"),this.pickerList=this.GetElement(".picker-card-view"),this.pickerTitle=this.GetElement(".picker-card-title"),this.Render(this.list)},e.prototype.GetElement=function(e){return document.querySelector(e)},e.prototype.Render=function(){for(var e=this,t=this.pickerList.innerHTML="",i=this.GetRenderList(),s=0;s<i.length;s++)t+='<li class="picker-item-'.concat(this.selectedList.length,'">').concat(i[s][this.options.caseName.text],"</li>");setTimeout(function(){e.pickerList.innerHTML="<ul>".concat(t,"</ul>")},100)},e.prototype.GetRenderList=function(e){var r=this;if(!this.selectedList.length&&!e||e&&!e.length)return this.list;var t=this.list.slice(),n=e||this.selectedList.slice(),c=[];return function e(t){for(var i=0;i<n.length;i++){var s=t.find(function(e){return e[r.options.caseName.text]==n[0]});c=s[r.options.caseName.children]?s[r.options.caseName.children]:[],1<n.length&&(n.splice(0,1),e(c))}}(t),c},e.prototype.Open=function(){this.picker.classList.remove("picker-card-hide"),this.picker.classList.add("picker-card-show"),this.pickerContainer.classList.remove("picker-card-hide"),this.pickerContainer.classList.add("picker-card-show"),document.body.setAttribute("style","position:fixed")},e.prototype.Close=function(){this.selectedList=[],document.body.removeChild(this.picker),document.body.removeAttribute("style")},e.prototype.CreateTitleItem=function(){for(var e="",t=0;t<this.selectedList.length;t++)e+='<div class="picker-preview-item"><span class="picker-preview-item-'.concat(t,'">').concat(this.selectedList[t],"</span></div>");e+='<div class="picker-preview-item picker-preview-item-'.concat(this.selectedList.length-1,'"><span class="picker-preview-item-last picker-preview-active">请选择</span></div>'),this.pickerTopbar.innerHTML=e},e});